<p>
  Audience: <span class="total">?</span><br/>
  <span class="joined"></span><br/>
  <span class="left"></span>
</p>
<input class="url" type="text" value="" />
<input class="username" type="text" value="" placeholder="username"/>
<input class="room" type="text" value="room1" placeholder="room"/>
<button class="connect" type="button">Connect</button>

<script src="bower_components/event-source-polyfill/eventsource.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js"></script>
<script src="jquery.audience.js"></script>
<script>

  $(document).ready(function(){

    var url, port = 9999;
    if( window.location.host === '' )
      url = 'http://localhost';
    else
      url = window.location.origin;
    url += ':' + port;

    $('.url').val(url)
    $('.username').val('a'+parseInt((Math.random()*1000)));

    var connect = function(username, room) {
      var url = $('.url').val() + '/' + room + '?username=' + username;
      console.log(url)
      $.audience(url, username).progress(function(data){
        $('.total, .joined, .left').text('');
        $('.total').text(data.audience);
        if( data.joined ) $('.joined').text( data.joined.join(',')+' joined');
        if( data.left ) $('.left').text( data.left.join(',')+' left');
      });
    };
    var buttonConnect = document.querySelector('.connect');
    buttonConnect.addEventListener('click', function(){
      connect( document.querySelector('.username').value, document.querySelector('.room').value )
    });


  });

</script>